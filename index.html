<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>F2etest by alibaba</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">F2etest</h1>
      <h2 class="project-tagline">F2etest是一个面向前端、测试、产品等岗位的多浏览器兼容性测试整体解决方案。</h2>
      <a href="https://github.com/alibaba/f2etest" class="btn">View on GitHub</a>
      <a href="https://github.com/alibaba/f2etest/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/alibaba/f2etest/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="f2etest" class="anchor" href="#f2etest" aria-hidden="true"><span class="octicon octicon-link"></span></a>F2etest</h1>

<p><img src="imgs/logo.png" alt="imgs/logo.png"></p>

<p>F2etest是一个面向前端、测试、产品等岗位的多浏览器兼容性测试整体解决方案。</p>

<p>注：F2e test = Front to End Test = 前端测试</p>

<p>在之前，我们一般有三种解决方案：</p>

<ol>
<li>本机安装大量的虚拟机，一个浏览器一个虚拟机，优点：真实，缺点：消耗硬盘资源，消耗CPU资源，打开慢，无法同时打开多个虚拟机</li>
<li>使用IeTester等模拟软件，优点：体积小，资源消耗小，缺点：不真实，很多特性不能代表真实浏览器</li>
<li>公用机器提供多种浏览器，优点：不需要本地安装，不消耗本机资源，缺点：资源利用率低，整体资源消耗非常恐怖</li>
</ol>

<p>现在，有了F2etest，一台普通的4核CPU的服务器，我们就可以提供给20人以上同时使用。</p>

<p>在这之前我们需要20台机器，相比之下，至少10倍的硬件利用率提升。</p>

<p>再加上我们平时做多浏览器测试时，并不是满负荷工作。经常是测试一会，开发一会，或者是忙点别的事，因此理论并发能力至少可以再乘2，就是说一台4核服务器，理论上跑40人同时在线，非常轻松。</p>

<p>但是在此之前，如果我们是单人虚拟机模式的话，当你没在测试时，CPU、内存、硬盘，全部都是处在浪费状态。</p>

<p>相比之前的方案，我们有以下优势：</p>

<ol>
<li>10倍以上硬件利用率，降低企业运营成本</li>
<li>非常棒的用户体验，极大的提高测试效率</li>
<li>真实浏览器环境，还原真实测试场景</li>
</ol>

<p>在这个解决方案中，我们使用了以下技术：</p>

<ol>
<li>Guacamole: 开源的HTML5远程解决方案</li>
<li>Windows Server: Server版Windows，最大化复用机器资源</li>
<li>hostsShare: 跨浏览器，跨服务器的hosts共享</li>
</ol>

<h1>
<a id="成功案例" class="anchor" href="#%E6%88%90%E5%8A%9F%E6%A1%88%E4%BE%8B" aria-hidden="true"><span class="octicon octicon-link"></span></a>成功案例</h1>

<p><a href="http://www.alibabagroup.com/"><img src="imgs/alibaba.png" alt="imgs/alibaba.png"></a></p>

<p>如果您使用了我们的解决方案，请联系我们添加在此处。</p>

<h1>
<a id="产品截图" class="anchor" href="#%E4%BA%A7%E5%93%81%E6%88%AA%E5%9B%BE" aria-hidden="true"><span class="octicon octicon-link"></span></a>产品截图</h1>

<p><img src="imgs/screenshot1.jpg" alt="imgs/screenshot1.jpg"></p>

<p><img src="imgs/screenshot2.jpg" alt="imgs/screenshot2.jpg"></p>

<p>Chrome插件:</p>

<p><img src="imgs/chrome.png" alt="imgs/chrome.png"></p>

<p>Windows:</p>

<p><img src="imgs/windows.jpg" alt="imgs/windows.jpg"></p>

<p>Mac:</p>

<p><img src="imgs/mac.jpg" alt="imgs/mac.jpg"></p>

<h1>
<a id="安全风险警示非常重要" class="anchor" href="#%E5%AE%89%E5%85%A8%E9%A3%8E%E9%99%A9%E8%AD%A6%E7%A4%BA%E9%9D%9E%E5%B8%B8%E9%87%8D%E8%A6%81" aria-hidden="true"><span class="octicon octicon-link"></span></a>安全风险警示(非常重要)</h1>

<p>由于本系统基于Windows Server体系搭建，因此系统的安全性完全取决于部署人的安全部署能力。</p>

<p>如果您希望部署本系统，请确保以下几点：</p>

<ol>
<li>严禁将本系统部署在公网环境，仅可部署在内网环境中使用，作为内部测试用途</li>
<li>请将Windows Server服务端升级到最新版本及补丁，以保证没有出现安全漏洞</li>
<li>请将User用户之间做到完全隔离，仅提供User用户文件的访问权限，别的任何权限请勿多余授权</li>
<li>请将f2etest-client仅设置为管理员拥有权限，防止API接口被恶意访问</li>
</ol>

<h1>
<a id="安装" class="anchor" href="#%E5%AE%89%E8%A3%85" aria-hidden="true"><span class="octicon octicon-link"></span></a>安装</h1>

<ol>
<li>
<p>安装nodejs</p>

<p>安装请访问官网：<a href="https://nodejs.org/">https://nodejs.org/</a>，如果已安装好，请略过。</p>
</li>
<li>
<p>下载f2etest代码</p>

<pre><code>git clone https://github.com/alibaba/f2etest.git
</code></pre>

<p>clone后，会发现以下几个目录：</p>

<ol>
<li>
<code>f2etest-web</code>: f2etest的WEB站点，用来提供f2etest服务，用户最终就是访问这个站点使用f2etest</li>
<li>
<code>f2etest-guacamole</code>: 这是我们定制过的开源版本，方便f2etest进行调用</li>
<li>
<code>f2etest-client</code>: f2etest的执行机客户端站点，主要提供API给f2etest-web使用，用来同步用户账号</li>
<li>
<code>hostsShare-client</code>: 安装在f2etest远程环境中的客户端，用来修改f2etest-web上的hosts绑定</li>
<li>
<code>f2etest-local</code>: 用来在本机安装代理服务器，并将f2etest所有访问反向代理到本地，以共享本机的hosts绑定，本组件已发布至npm，无需安装，详细使用请至系统内查看帮助</li>
<li>
<code>f2etest-chrome</code>: chrome浏览器下的客户端，无需打开f2etest网站，即可访问f2etest中的所有APP，本组件已发布至chrome官方市场，无需安装，详细使用请至系统内查看帮助</li>
</ol>

<p>下面分别针对前4个组件，会有针对性的安装教程。</p>

<p>我们建议将1，2组件安装在同一台Linux服务器上，操作系统为CentOs。</p>
</li>
<li>
<p>安装f2etest-guacamole</p>

<p>f2etest-guacamole是定制版本的guacamole，安装方法请查看：<a href="./f2etest-guacamole/Install.md">Install Guacamole</a></p>
</li>
<li>
<p>安装mysql</p>

<p>安装mysql: <a href="https://www.mysql.com/">https://www.mysql.com/</a>，如果已安装好，请略过安装步骤。</p>

<p>新建库：f2etest</p>

<p>初始化表结构：f2etest-web/f2etest.sql</p>
</li>
<li>
<p>配置f2etest-web</p>

<p>初始化f2etest-web</p>

<pre><code>cd f2etest-web
npm install
</code></pre>

<p>修改conf/site.json：</p>

<ol>
<li>port: 站点监听端口号</li>
<li>name: 站点名称，修改为自己站点名称</li>
<li>about: 站点介绍，显示在网页title后面，修改为自己的站点介绍</li>
<li>icon: 站点icon，默认不需要修改</li>
<li>dbHost: 数据库连接信息，修改为mysql服务器IP地址</li>
<li>dbUser: 同上</li>
<li>dbPass: 同上</li>
<li>dbTable: 同上</li>
<li>clientApiKey: f2etest远程桌面客户端的ApiKey，正确的ApiKey才能访问远程的API，用来创建当前用户的账号，请更改为随机值，并保持和f2etest-client中的值一致</li>
<li>guacamoleApi: guacamole的API，请修改为上面第3步安装完成的API</li>
<li>footer: 根据需要修改</li>
<li>statNav: 如果需要自行扩展统计页面，根据需要修改</li>
</ol>

<p>修改conf/server.json：</p>

<blockquote>
<p>这里的id必需要与f2etest-guacamole中的名字保持一致</p>

<p>2003系统不支持remoteApp，2008以上Server系统支持</p>
</blockquote>

<p>修改conf/app.json：</p>

<blockquote>
<p>这里的server必需为server.json中已配置的id。program为可选参数，如果不填则直接连接桌面。</p>
</blockquote>

<p>修改<code>lib/sso.js</code>：</p>

<blockquote>
<p>由于f2etest系统要求必需是登录用户才能访问，因此必需要对接SSO系统才能工作。</p>

<p>请参考现有的<code>sso.js</code>文件进行修改，对接到您公司内部SSO系统。</p>
</blockquote>

<p>启动f2etest-web服务：</p>

<pre><code>node app.js
</code></pre>

<p>启动成功后，可以发现WEB服务默认工作在：3000端口号</p>

<p>小建议：</p>

<ol>
<li>为了方便用户使用，建议安装nginx等软件做反向代理，将80端口反向到3000端口，以将3000端口号隐藏起来。</li>
<li>建议使用pm2或forever等组件实现系统开机自动运行。</li>
</ol>
</li>
<li>
<p>安装windows server机群</p>

<ul>
<li>1号机：Server 2003: IE6</li>
<li>2号机：Server 2003: IE7</li>
<li>3号机：Server 2008: IE8</li>
<li>4号机：Server 2008: IE9</li>
<li>5号机：Server 2008: IE10</li>
<li>6号机：Server 2008: IE11</li>
</ul>

<p>将来如果出现新的浏览器，可以即时增加新的服务器，用来部署新浏览器或软件。</p>

<p>如果在现有运行一段时间的系统中部署新服务器，请访问以下URL来同步所有账号：<code>http://f2etest.xxx.com/syncAllRemoteUsers</code></p>

<p>由于Server 2008可安装的最低IE版本是8，因此IE6和IE7只能安装在Server 2003系统中。</p>

<p>安装软件及配置：</p>

<ol>
<li>远程桌面会话主机：授权模式请选择按用户，会话请选择5分钟自动结束，空闲会话不允许超过6小时，颜色限制最大24位色</li>
<li>远程桌面授权：必需要进行正确激活并安装授权，安装时请选择企业授权，并按用户授权</li>
<li>IIS：用来部署f2etest-client，由于我们的脚本使用asp编写，因此请安装asp相关支持组件</li>
<li>设置当前主机每天凌晨自动重启：防止开机久了，系统出现不稳定</li>
<li>用户组配置：请将Authenticated Users添加到Remote Desktop Users，允许普通用户可以登录远程</li>
<li>安装curl: 将curl的路径添加到系统变量的PATH路径中，以供APP快捷方式调用</li>
<li>配置Remote App：如果是2008操作系统，需要将被远程的程序添加到Remote App，否则无法远程，添加快捷方式时请选择：允许任何命令行参数</li>
<li>安装周边软件：输入法，Flash等</li>
</ol>

<p>提示及注意事项：</p>

<ol>
<li>chrome由于和远程桌面有点小冲突，必需安装在2003操作系统中</li>
<li>使用频率比较低的浏览器，建议硬件配置可以适当降低</li>
<li>2008如果默认安装的是IE10浏览器，可以从安装补丁上卸载，从而降级到IE8，但是没办法降级到IE6或IE7</li>
<li>建议在任务计划程序中添加每周磁盘碎片整理，以保持最高工作性能</li>
</ol>

<p>IE浏览器安全级别低解决方案：</p>

<ol>
<li>以桌面模式连接一个User用户</li>
<li>按照需要自由配置IE</li>
<li>打开<code>regedit</code>，导出<code>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings\</code>为<code>c:\ie.reg</code>
</li>
<li>切换为<code>administrator</code>用户</li>
<li>用文本软件打开<code>c:\ie.reg</code>，替换<code>HKEY_CURRENT_USER</code>为<code>HKEY_Users\Default</code>
</li>
<li>打开<code>regedit</code>，注册表编辑器中选择节点：<code>HKEY_USERS</code>，文件菜单-&gt;<code>加载配置单元</code>，选择<code>C:\Users\Default\NTUser.dat</code>，项名称输入：<code>Default</code>
</li>
<li>双击<code>c:\ie.reg</code>导入注册表</li>
<li>在注册表编辑器中选择刚才加载的配置单元：<code>Default</code>，文件菜单-&gt;<code>卸载配置单元</code>，并确认上载</li>
</ol>

<p>如何在每台服务器全局添加可信的根证书：</p>

<ol>
<li>命令行打开<code>mmc</code>
</li>
<li>菜单-&gt;<code>添加/删除管理单元</code>, 并选择：<code>证书</code>
</li>
<li>下一步选择：<code>计算机帐户</code>，再点击下一步</li>
<li>在<code>受信任的根证书颁发机构</code>的<code>证书</code>栏目中添加CA即可</li>
</ol>
</li>
<li>
<p>部署f2etest-client</p>

<p>每台Server服务器上都需要部署f2etest-client，实现以下两个功能：</p>

<ol>
<li>提供API给f2etest-web调用，用来初始化用户账号</li>
<li>远程桌面连接时，需要打开指定的浏览器或软件，并统计相应软件的使用次数</li>
</ol>

<p>请根据需要选择合适的bat模板，模板中需要修改3处地方：</p>

<ol>
<li>
<code>f2etestDomain</code>: 修改为内部部署的f2etest域名</li>
<li>
<code>appid</code>: 修改为f2etest-web中配置的相同应用id</li>
<li>
<code>打开应用</code>： 替换为应用的程序路径</li>
</ol>

<p>由于需要在当前系统中添加新用户，f2etest-web站点必需设置为administrator权限，否则无法工作</p>

<p>修改setuser.asp中的apiKey，保持和f2etest-web中一致。</p>

<p>2008中必需要安装Remote App，并且要在Remote App的设置中：允许任何命令行参数。</p>

<p>重要安全说明：f2etest-client的www目录必需要设置为仅管理员有权限，否则任何人都可以查看到setuser.asp中的apiKey，会有严重的安全风险</p>
</li>
<li>
<p>安装hostsShare-client</p>

<p>hostsShare-client基于node-webkit开发，默认已经提供了一个编译版本在build目录中，可以直接部署使用。</p>

<p>本应用使用频率较高，建议选择CPU比较空闲的机器上部署。</p>

<p>hostsShare-client的bat可直接复制f2etest-client/app/中的：<code>禁用代理.bat</code></p>
</li>
</ol>

<h1>
<a id="使用" class="anchor" href="#%E4%BD%BF%E7%94%A8" aria-hidden="true"><span class="octicon octicon-link"></span></a>使用</h1>

<ol>
<li>
<p>WEB方式</p>

<p>我们基于guacamole实现WEB方式的使用，没有任何学习成本。</p>

<p>详细教程请参考f2etest-web中的帮助信息</p>
</li>
<li>
<p>桌面方式</p>

<p>桌面方式基于TSWF Schema协议实现的分发，目前Windows和MAC下都有完美的协议实现软件。</p>

<p>Win7天然就支持远程TSWF分发技术，Mac下仅需安装<a href="https://itunes.apple.com/us/app/microsoft-remote-desktop/id715768417">Microsoft Remote Desktop</a>，也可完美支持TSWF，注意此软件需要使用英文市场下的id才能安装。</p>

<p>无论是Win7还是Mac，目前都已经完美支持Remote APP技术，实现远程应用本地化的完美体验。</p>

<p>相比较之下，由于桌面方式属于直连，性能上会更加理想，因此我们建议用户使用桌面方式。</p>
</li>
</ol>

<h1>
<a id="感谢" class="anchor" href="#%E6%84%9F%E8%B0%A2" aria-hidden="true"><span class="octicon octicon-link"></span></a>感谢</h1>

<ul>
<li>Guacamole: <a href="http://guac-dev.org/">http://guac-dev.org/</a>
</li>
<li>Nodejs: <a href="http://nodejs.org/">http://nodejs.org/</a>
</li>
</ul>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/alibaba/f2etest">F2etest</a> is maintained by <a href="https://github.com/alibaba">alibaba</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
